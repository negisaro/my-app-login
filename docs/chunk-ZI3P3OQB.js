import{G as u,ba as h,g as i,h as l,i as a,k as c,ka as g,la as b,n as p,r as m,ua as f}from"./chunk-DRKUHF5Z.js";var d=class o{baseUrl=f.baseUrl;http=m(b);_currentUser=u(null);_authStatus=u("checking");currentUser=h(()=>this._currentUser());authStatus=h(()=>this._authStatus());constructor(){this.checkAuthStatus().subscribe()}setAuthentication(e,t){return this._currentUser.set(e),this._authStatus.set("authenticated"),localStorage.setItem("token",t),!0}login(e,t){let n=`${this.baseUrl}/login`,s={username:e,password:t};return this.http.post(n,s).pipe(a(({user:r,token:k})=>this.setAuthentication(r,k)),c(r=>l(()=>r.error.message)))}checkAuthStatus(){let e=`${this.baseUrl}/login`,t=localStorage.getItem("token");if(!t)return this.logout(),i(!1);let n=new g().set("Authorization",`Bearer ${t}`);return this.http.get(e,{headers:n}).pipe(a(({user:s,token:r})=>this.setAuthentication(s,r)),c(()=>(this._authStatus.set("notAuthenticated"),i(!1))))}logout(){localStorage.removeItem("token"),this._currentUser.set(null),this._authStatus.set("notAuthenticated")}static \u0275fac=function(t){return new(t||o)};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{d as a};
